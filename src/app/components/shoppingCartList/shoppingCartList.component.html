<button mat-button (click)="uploadCarts2firestore()">upload Cart</button>

<mat-toolbar style="position: fixed; top: 0%; width: 100%; z-index: 100">
  <div id="commands">
    <app-my-menu></app-my-menu>
    <button mat-button (click)="uploadCarts2firestore()">
      upload Carrelli
    </button>
    <button mat-fab extended id="createSellerr" (click)="createCart()">
      <mat-icon>add</mat-icon>
    </button>
    <mat-label>filtra per data</mat-label>
    <form [formGroup]="filterForm">
      <mat-form-field id="selector">
        <mat-select
          [(value)]="timeFilterLimit"
          formControlName="limit"
          class="dropDown-seasons-panel"
        >
          <mat-option [value]="7"> ultima settimana</mat-option>
          <mat-option [value]="14"> ultime 2 settimane</mat-option>
          <mat-option [value]="28"> ultimo mese</mat-option>
          <mat-option [value]="365"> ultimo anno</mat-option>
          <mat-option [value]="3650"> ultimi 10 anni</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <input
          matInput
          type="text"
          placeholder="search"
          formControlName="fullText"
          id="searchCart"
        />
      </mat-form-field>
    </form>
  </div>
</mat-toolbar>
<mat-progress-bar
  mode="determinate"
  value="{{ progress() }}"
></mat-progress-bar>
@if(carts().length) {
<table
  mat-table
  [dataSource]="carts() | appSorterPipe | filterPipe : filterFunction"
  class="mat-elevation-z8"
>
  <ng-container matColumnDef="title">
    <th mat-header-cell *matHeaderCellDef>titolo</th>
    <td mat-cell *matCellDef="let element">{{ element.title }}</td>
  </ng-container>
  <ng-container matColumnDef="dataAcquisto">
    <th mat-header-cell *matHeaderCellDef>data</th>
    <td mat-cell *matCellDef="let element">{{ element.buyngDate }}</td>
  </ng-container>
  <ng-container matColumnDef="note">
    <th mat-header-cell *matHeaderCellDef>note</th>
    <td mat-cell *matCellDef="let element">{{ element.note }}</td>
  </ng-container>

  <ng-container matColumnDef="totale">
    <th mat-header-cell *matHeaderCellDef>pagato su un totale di</th>
    <td mat-cell *matCellDef="let element">
      {{ fixed(element.paiedAmount, 2) }}/{{ fixed(element.totale, 2)
      }}{{ element.currency }}
    </td>
  </ng-container>

  <ng-container matColumnDef="fornitore">
    <th mat-header-cell *matHeaderCellDef>fornitore</th>
    <td mat-cell *matCellDef="let element">
      <app-sellerViewer [sellerKey]="element.sellerKey"></app-sellerViewer>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr
    mat-row
    *matRowDef="let row; columns: displayedColumns"
    [matMenuTriggerFor]="menu"
    [matMenuTriggerData]="{ data: row }"
  ></tr>
</table>

<mat-menu #menu="matMenu">
  <ng-template matMenuContent let-cart="data">
    <button mat-menu-item (click)="updateItem(cart)">
      <mat-icon>create</mat-icon>
      <span>modifica</span>
    </button>

    <button mat-menu-item (click)="deleteItem(cart)">
      <mat-icon>delete</mat-icon>
      <span>elimina</span>
    </button>
  </ng-template>
</mat-menu>
} @else {
<div id="spinner">
  <mat-spinner></mat-spinner>
</div>
}
